<!doctype html>
<html><head><meta charset='utf-8'><title>Dashboard</title>
<style>body{font-family:Arial;margin:20px;background:#f5f7fb}.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}.card{background:#fff;padding:14px;border-radius:12px;border:1px solid #dbe2ee}input,select,textarea{padding:8px;margin:6px;border:1px solid #cbd5e1;border-radius:8px;width:95%}button{padding:9px 13px;border:0;border-radius:8px;background:#2563eb;color:#fff;cursor:pointer}table{width:100%;border-collapse:collapse}th,td{padding:8px;border-bottom:1px solid #e2e8f0;font-size:13px}</style></head>
<body>
  <h1>{{user.name}} — Weight Loss Dashboard</h1>
  <p>Current: <b>{{user.weight_kg}} kg</b> | Goal: <b>{{user.goal_weight_kg}} kg</b> | Activity: {{user.activity_level}}</p>

  <div class='grid'>
    <div class='card'>
      <h3>Generate Diet + Exercise Plan</h3>
      <form method='post' action='/generate-plan/{{user.id}}'>
        <button type='submit'>Generate / Refresh Plan</button>
      </form>
      {% if plan %}
      <p><b>Calories:</b> {{plan.calories}} kcal | <b>Protein:</b> {{plan.protein_g}}g | <b>Carbs:</b> {{plan.carbs_g}}g | <b>Fats:</b> {{plan.fats_g}}g</p>
      <p><b>Meals:</b> {{plan.meals}}</p>
      <p><b>Workouts:</b> {{plan.workouts}}</p>
      <p><b>Coach Notes:</b> {{plan.notes}}</p>
      {% endif %}
    </div>

    <div class='card'>
      <h3>Daily Check-in</h3>
      <form method='post' action='/checkin/{{user.id}}'>
        <input type='number' step='0.1' name='weight_kg' placeholder='Weight (kg)' required>
        <input type='number' name='steps' placeholder='Steps' value='7000' required>
        <label><input type='checkbox' name='workout_done' value='1'> Workout done</label>
        <input type='number' name='diet_adherence' placeholder='Diet adherence %' value='75' min='0' max='100' required>
        <select name='mood'><option>great</option><option selected>ok</option><option>low</option></select>
        <textarea name='notes' placeholder='Notes'></textarea>
        <button type='submit'>Save Check-in</button>
      </form>
    </div>
  </div>

  <div class='card' style='margin-top:14px'>
    <h3>Progress (latest first)</h3>
    <table>
      <thead><tr><th>Date</th><th>Weight</th><th>Steps</th><th>Adherence</th><th>Coach Comment</th></tr></thead>
      <tbody>
        {% for c in checkins %}
        <tr><td>{{c.date}}</td><td>{{c.weight_kg}}</td><td>{{c.steps}}</td><td>{{c.diet_adherence}}%</td><td>{{c.coach_comment}}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <p><a href='/'>← Back</a></p>
</body></html>